<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mi Portafolio - Estilo Minecraft</title>
  <link rel="stylesheet" href="styles.css">

  <link rel="icon" type="image/png" href="assets\textures\com\minecraft_logo_icon_168974.png">

  <link rel="preload" href="assets/fonts/Minecraft.ttf" as="font" type="font/ttf" crossorigin>
</head>

<body>
  <canvas id="bg"></canvas>

  <div id="language-switcher-container" class="language-switcher">
    <button class="mc-menu-btn small-button" id="btn-language" aria-label="Change language">Lenguaje</button>
    <div id="language-dropdown" class="language-dropdown hidden">
      <button class="lang-option" data-lang="en">English</button>
      <button class="lang-option" data-lang="es">Español</button>
    </div>
  </div>


  <video class="mc-menu-bg-video" autoplay loop muted playsinline>
    <source src="assets/textures/MInecraft Calm Lake - vorobbkk (1080p, vp9).webm" type="video/webm" />

  </video>
  <div class="mc-menu-bg"></div>

  <audio id="nether-ambient-sound" loop preload="auto">

    <source src="assets/sounds/nether_ambient.mp3" type="audio/mpeg">
  </audio>
  <audio id="fire-sound" loop preload="auto">
    <source src="assets/textures/fire.mp3" type="audio/mpeg">
  </audio>
  <audio id="ui-sound" preload="auto">
    <source src="assets/textures/Untitled-video-Made-with-Clipchamp.mp3" type="audio/mpeg">
  </audio>
  <audio id="villager-sound" preload="auto">
    <source src="assets/textures/com/minecraft-villager-289282.mp3" type="audio/mpeg">
  </audio>
  <div class="mc-menu-container">
    <div class="mc-menu-header">

      <img src="assets/textures/PORTAFOLIO-4-11-2025.png" alt="PORTAFOLIO" class="menu-title-image">

      <img src="assets/textures/Piero-Sansossio-Edition-4-11-2025.png" alt="Piero Sansossio edition"
        class="menu-subtitle-image">
    </div>
    <div class="mc-menu-buttons">

      <button class="mc-menu-btn large" id="btn-about">About Me</button>
      <button class="mc-menu-btn large" id="btn-projects">Projects</button>


      <div class="bottom-menu">
        <button class="mc-menu-btn small-button" id="btn-contact">Contact</button>
        <button class="mc-menu-btn small-button" id="btn-resume">My Resume</button>
      </div>
    </div>
  </div>


  <div id="portal-overlay" class="portal-overlay">
    <div class="portal-frame"></div>
  </div>


  <div id="nether-projects-container" class="nether-projects-container">
    <div class="nether-content">
      <button id="nether-close-btn" class="nether-close-btn">&times;</button>
      <h2>Nether Projects</h2>
      <div id="projects-grid" class="projects-grid">

      </div>
      <button id="btn-back-to-overworld" class="mc-menu-btn nether-btn">Back to Overworld</button>
    </div>
  </div>





  <div id="project-detail-modal" class="hidden">
    <div class="modal-content">
      <button id="close-project-modal">&times;</button>
      <h2 id="modal-title">Title</h2>
      <div id="modal-gallery" class="modal-gallery">

      </div>
      <p id="modal-description">Description...</p>
      <div class="modal-footer">
        <a id="modal-link" href="#" target="_blank" rel="noopener noreferrer" class="mc-menu-btn small-button">View
          Project</a>
        <div id="modal-tech" class="modal-tech-stack">

        </div>
      </div>
    </div>
  </div>




  <div id="image-lightbox" class="hidden">
    <span id="close-lightbox">&times;</span>
    <button id="prev-image" class="lightbox-nav prev">&lt;</button>
    <img id="lightbox-image" src="" alt="Enlarged project image">
    <button id="next-image" class="lightbox-nav next">&gt;</button>
  </div>



  <div id="book-container" class="book-container">
    <div class="book-content">
      <div class="book">
        <div class="book-cover">
          <div class="book-cover-content">
            <h2>Piero's Journal</h2>
            <span>(About Me)</span>
          </div>
        </div>
        <div id="resume-content" class="book-page"></div>
      </div>
      <button id="book-close-btn" class="book-close-btn">Close Book</button>
    </div>
  </div>


  <div id="map-container" class="map-container">
    <!-- Este contenedor está vacío, pero lo declaro para evitar errores en el script si se referencia. -->
  </div>


  <!-- Nueva sección de Contacto: Mesa de Encantamientos -->
  <div id="villager-trade-container" class="villager-trade-container hidden">
    <div class="villager-trade-content">
      <button id="villager-trade-close-btn" class="villager-trade-close-btn">&times;</button>
      <h2>Trade with Piero</h2>
      <div class="villager-trade-ui">
        <div class="villager-portrait">
          <img src="assets/textures/com/Plains_Villager_Base.webp" alt="Villager Piero">
        </div>
        <div class="trade-list">
          <!-- Trade for LinkedIn -->
          <a href="https://www.linkedin.com/in/pierosansossio-590877291" target="_blank" rel="noopener"
            class="trade-offer">
            <div class="trade-slot"><img src="assets/textures/com/emerald.jpeg" alt="Emerald">
            </div>
            <div class="trade-arrow"></div>
            <div class="trade-slot"><img src="assets/textures/com/paper.png" alt="Paper">
              <span>LinkedIn</span>
            </div>
          </a>
          <!-- Trade for GitHub -->
          <a href="https://github.com/pierox-afk" target="_blank" rel="noopener" class="trade-offer">
            <div class="trade-slot"><img src="assets/textures/com/emerald.jpeg" alt="Emerald">
            </div>
            <div class="trade-arrow"></div>
            <div class="trade-slot"><img src="assets/textures/com/Book_JE2_BE2.png" alt="Book">
              <span>GitHub</span>
            </div>
          </a>
          <!-- Trade for Email -->
          <a href="mailto:piero.sansossio@gmail.com" class="trade-offer" data-no-sound="true">
            <div class="trade-slot"><img src="assets/textures/com/emerald.jpeg" alt="Emerald">
            </div>
            <div class="trade-arrow"></div>
            <div class="trade-slot"><img src="assets/textures/com/writable_book.png" alt="Book and Quill">
              <span>Email</span>
            </div>
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Nueva sección para el CV con temática del End -->
  <div id="end-cv-container" class="end-cv-container hidden">
    <div class="end-stars"></div>
    <div class="end-stars-2"></div>
    <div class="end-cv-content">
      <button id="end-cv-close-btn" class="end-cv-close-btn">&times;</button>
      <h2>Mi CV</h2>
      <div class="cv-images">
        <img src="assets/textures/Piero_cvlast.pdf-1.png" alt="CV Página 1">
        <img src="assets/textures/Piero_cvlast.pdf-2.png" alt="CV Página 2">
      </div>
    </div>
  </div>

  <!-- Contenedor para la animación de transición al End -->
  <div id="end-portal-transition" class="end-portal-transition hidden">
    <div class="portal-vortex">
      <!-- El contenido del portal ahora se genera con CSS -->
    </div>
  </div>

  <script type="module">
    import * as THREE from './lib/three.js-master/build/three.module.js';
    window.THREE = THREE;
  </script>
  <script>
    (function () {
      const vid = document.querySelector('.mc-menu-bg-video');
      if (!vid) return;
      const srcEl = vid.querySelector('source');
      if (!srcEl) return;
      const rawPath = srcEl.getAttribute('src');
      const encoded = encodeURI(rawPath);
      if (encoded !== rawPath) srcEl.setAttribute('src', encoded);


      vid.load();
      vid.addEventListener('loadeddata', () => {
        console.log('mc menu video loaded OK');
        vid.style.display = 'block';
        const fallback = document.querySelector('.mc-menu-bg');
        if (fallback) fallback.style.display = 'none';
      });
      vid.addEventListener('error', (ev) => {
        console.error('mc menu video error', ev);
        vid.style.display = 'none';
        const fallback = document.querySelector('.mc-menu-bg');
        if (fallback) fallback.style.display = 'block';
      });
      vid.play().catch((err) => {
        console.warn('video.play() rejected:', err);

        vid.style.display = 'none';
        const fallback = document.querySelector('.mc-menu-bg');
        if (fallback) fallback.style.display = 'block';
      });
    })();
  </script>
  <script src="main.js"></script>
  <script>

    document.addEventListener('DOMContentLoaded', async function () {

      const toolbelt = document.getElementById('toolbelt');
      if (toolbelt) {
        let selectedTool = 'hand';
        toolbelt.addEventListener('click', (e) => {
          const btn = e.target.closest('.tool-btn');
          if (!btn) return;
          document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          selectedTool = btn.dataset.tool;

          window.portfolioSelectedTool = selectedTool;
        });
      }


      const chestModal = document.getElementById('chest-modal');
      const closeChest = document.getElementById('close-chest');
      if (closeChest) closeChest.addEventListener('click', (e) => { e.preventDefault(); chestModal.classList.add('hidden'); });


      const projectDetailModal = document.getElementById('project-detail-modal');
      document.getElementById('close-project-modal').addEventListener('click', () => projectDetailModal.classList.add('hidden'));


      const imageLightbox = document.getElementById('image-lightbox');
      const lightboxImage = document.getElementById('lightbox-image');
      const prevImageBtn = document.getElementById('prev-image');
      const nextImageBtn = document.getElementById('next-image');
      let currentProjectImages = [];
      let currentImageIndex = 0;

      function updateLightboxImage() {
        if (currentProjectImages.length > 0) {
          lightboxImage.src = currentProjectImages[currentImageIndex];
        }
      }


      imageLightbox.addEventListener('click', () => {
        imageLightbox.classList.add('hidden');
      });


      prevImageBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        currentImageIndex = (currentImageIndex - 1 + currentProjectImages.length) % currentProjectImages.length;
        updateLightboxImage();
      });

      nextImageBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        currentImageIndex = (currentImageIndex + 1) % currentProjectImages.length;
        updateLightboxImage();
      });


      lightboxImage.addEventListener('click', (e) => e.stopPropagation());


      let currentLanguage = 'en';
      let siteData = {};

      function setLanguage(lang) {
        currentLanguage = lang;

        updateUIText();
        populateProjects(siteData.projects);
        populateResume(siteData.resume);


      }


      try {
        const response = await fetch('data.json');
        siteData = await response.json();
        setLanguage(currentLanguage);
      } catch (error) {
        console.error('Error fetching or populating data:', error);
      }


      const menuContainer = document.querySelector('.mc-menu-container');
      const menuVideo = document.querySelector('.mc-menu-bg-video');
      const menuBg = document.querySelector('.mc-menu-bg');
      const gameUI = document.querySelectorAll('.instructions');
      const fireSound = document.getElementById('fire-sound');
      const netherSound = document.getElementById('nether-ambient-sound');
      const netherProjectsContainer = document.getElementById('nether-projects-container');
      const bookContainer = document.getElementById('book-container');
      const mapContainer = document.getElementById('map-container');
      const languageSwitcher = document.getElementById('language-switcher-container');
      const villagerTradeContainer = document.getElementById('villager-trade-container');
      const endCvContainer = document.getElementById('end-cv-container');






      function unlockAudio() {
        netherSound.play().then(() => netherSound.pause()).catch(() => { });
        fireSound.play().then(() => fireSound.pause()).catch(() => { });
        const villagerSound = document.getElementById('villager-sound');
        if (villagerSound) villagerSound.play().then(() => villagerSound.pause()).catch(() => { });

        window.removeEventListener('click', unlockAudio);
      }
      window.addEventListener('click', unlockAudio);



      function enterScene() {
        // Ocultar todos los contenedores principales
        menuContainer.classList.add('hidden');
        languageSwitcher.classList.add('hidden');
        bookContainer.classList.remove('visible');
        villagerTradeContainer.classList.add('hidden');
        endCvContainer.classList.add('hidden');



        const portalOverlay = document.getElementById('portal-overlay');
        portalOverlay.classList.add('active');


        setTimeout(() => {
          if (menuVideo) menuVideo.style.display = 'none';

          menuBg.style.opacity = '0';
          document.body.classList.add('nether-bg');
          portalOverlay.classList.remove('active');
          netherProjectsContainer.classList.add('visible');
        }, 1500);
      }

      function returnToMenu() {
        const isFromNether = netherProjectsContainer.classList.contains('visible');

        // Ocultar todos los contenedores de "escena"
        if (isFromNether) {

          netherSound.pause();
          netherSound.currentTime = 0;
          fireSound.pause();
          fireSound.currentTime = 0;

          netherProjectsContainer.classList.remove('visible');


          const portalOverlay = document.getElementById('portal-overlay');
          portalOverlay.classList.add('active');


          setTimeout(() => {
            document.body.classList.remove('nether-bg');
            portalOverlay.classList.remove('active');
            // Mostrar el menú principal al final de la transición
            showMainMenu();
          }, 1500);
        } else {
          // Ocultar libro y mesa de crafteo
          const book = bookContainer.querySelector('.book');
          if (book && book.classList.contains('open')) book.classList.remove('open');
          bookContainer.classList.remove('visible');
          villagerTradeContainer.classList.add('hidden');
          endCvContainer.classList.add('hidden');
          // Mostrar el menú principal
          showMainMenu();
        }
      }

      function showMainMenu() {
        if (menuVideo) menuVideo.style.display = 'block';
        menuBg.style.opacity = '1';
        menuContainer.classList.remove('hidden');
        languageSwitcher.classList.remove('hidden');
      }




      document.getElementById('btn-about').addEventListener('click', (e) => {
        e.preventDefault();
        menuContainer.classList.add('hidden');
        bookContainer.classList.add('visible');
      });

      document.getElementById('btn-projects').addEventListener('click', (e) => {
        e.preventDefault();

        try {
          netherSound.volume = 0.5;
          netherSound.play();
          fireSound.volume = 0.4;
          fireSound.play();
        } catch (err) {
          console.error("Error al reproducir sonidos ambientales:", err);
        }
        enterScene();
      });

      document.getElementById('btn-contact').addEventListener('click', (e) => {
        e.preventDefault();
        try {
          const villagerSound = document.getElementById('villager-sound');
          villagerSound.currentTime = 0;
          villagerSound.play();
        } catch (err) {
          console.error("Error al reproducir sonido de aldeano:", err);
        }
        menuContainer.classList.add('hidden');
        villagerTradeContainer.classList.remove('hidden');
      });

      document.getElementById('btn-resume').addEventListener('click', (e) => {
        e.preventDefault();
        const endPortalTransition = document.getElementById('end-portal-transition');

        // Ocultar menú
        menuContainer.classList.add('hidden');
        languageSwitcher.classList.add('hidden');

        // Iniciar animación
        endPortalTransition.classList.remove('hidden');
        endPortalTransition.classList.add('active');

        // Después de la animación, mostrar el CV y ocultar la transición
        setTimeout(() => {
          endCvContainer.classList.remove('hidden');
          endPortalTransition.classList.add('hidden');
          endPortalTransition.classList.remove('active');
        }, 1500); // Reducimos la duración para que coincida con la nueva animación
      });



      document.querySelector('.book-cover').addEventListener('click', () => {
        const book = document.querySelector('.book');
        book.classList.add('open');
      });


      document.getElementById('book-close-btn').addEventListener('click', () => {
        const book = bookContainer.querySelector('.book');


        if (book && book.classList.contains('open')) {
          book.classList.remove('open');


          setTimeout(() => {
            bookContainer.classList.remove('visible');
            showMainMenu();
          }, 1200);
        } else {

          returnToMenu();
        }
      });


      document.getElementById('villager-trade-close-btn').addEventListener('click', () => {
        villagerTradeContainer.classList.add('hidden');
        returnToMenu();
      });

      document.getElementById('end-cv-close-btn').addEventListener('click', () => {
        endCvContainer.classList.add('hidden');
        // No es necesario llamar a returnToMenu aquí si showMainMenu ya lo hace
        returnToMenu();
      });

      document.getElementById('nether-close-btn').addEventListener('click', () => {
        returnToMenu();
      });

      document.getElementById('btn-back-to-overworld').addEventListener('click', () => {
        returnToMenu();
      });

      function getText(data) {
        if (typeof data === 'string') return data;
        return data[currentLanguage] || data['en'];
      }

      function updateUIText() {

        document.getElementById('btn-about').textContent = currentLanguage === 'en' ? 'About Me' : 'Sobre Mí';
        document.getElementById('btn-projects').textContent = currentLanguage === 'en' ? 'Projects' : 'Proyectos';
        document.getElementById('btn-contact').textContent = currentLanguage === 'en' ? 'Contact' : 'Contacto';
        document.getElementById('btn-resume').textContent = currentLanguage === 'en' ? 'My Resume' : 'Mi CV';


        const langButton = document.getElementById('btn-language');
        const langDropdown = document.getElementById('language-dropdown');
        langButton.textContent = currentLanguage === 'en' ? 'Language' : 'Idioma';


        langButton.onclick = (e) => {
          e.preventDefault();
          e.stopPropagation();
          langDropdown.classList.toggle('hidden');
        };


        document.querySelectorAll('.lang-option').forEach(option => {
          option.onclick = (e) => {
            e.preventDefault();
            setLanguage(option.dataset.lang);
            langDropdown.classList.add('hidden');
          };
        });


        window.addEventListener('click', () => {
          if (!langDropdown.classList.contains('hidden')) {
            langDropdown.classList.add('hidden');
          }
        });

        document.querySelector('.book-cover-content h2').textContent = currentLanguage === 'en' ? "Piero's Journal" : "Diario de Piero";
        document.querySelector('.book-cover-content span').textContent = currentLanguage === 'en' ? "(About Me)" : "(Sobre Mí)";
        document.getElementById('book-close-btn').textContent = currentLanguage === 'en' ? 'Close Book' : 'Cerrar Libro';
        document.querySelector('.nether-content h2').textContent = currentLanguage === 'en' ? 'Nether Projects' : 'Proyectos del Nether';
        document.getElementById('btn-back-to-overworld').textContent = currentLanguage === 'en' ? 'Back to Overworld' : 'Volver al Overworld';;
        document.querySelector('#villager-trade-container h2').textContent = currentLanguage === 'en' ? 'Trade with Piero' : 'Comerciar con Piero';
        document.getElementById('modal-link').textContent = currentLanguage === 'en' ? 'View Project' : 'Ver Proyecto';
        document.querySelector('#end-cv-container h2').textContent = currentLanguage === 'en' ? 'My CV' : 'Mi CV';
      }

      function populateResume(resumeData) {
        const resume = document.getElementById('resume-content');
        if (!resume) return;
        resume.innerHTML = `
          <div class="book-page-left">
            <header class="resume-header">
              <h1>${getText(resumeData.name)}</h1>
              <div class="resume-meta">
              </div>
            </header>
            <div class="resume-body">
              <h3>${currentLanguage === 'en' ? 'Profile' : 'Perfil'}</h3>
              <p>${getText(resumeData.profile)}</p>
            </div>
          </div>
          <div class="book-page-right">
            <h3>${currentLanguage === 'en' ? 'My Growth Strategy' : 'Mi Estrategia de Crecimiento'}</h3>
            <p>${getText(resumeData.education.description)}</p>
            <br>
            
            <p>${getText(resumeData.profileSummary)}</p>
          </div>`;
      }

      function populateProjects(projectsData) {
        const projectsGrid = document.getElementById('projects-grid');
        if (!projectsGrid) return;
        projectsGrid.innerHTML = projectsData.map(project => {
          // Caso especial para el proyecto "Este Portafolio"
          if (project.title.en === "This Portfolio") {
            return `
              <div class="project-card-nether">
                <h3>${getText(project.title)}</h3>
                <p>${getText(project.description)}</p>
                <a href="${project.link}" target="_blank" rel="noopener noreferrer" class="btn-details">${currentLanguage === 'en' ? 'View on GitHub' : 'Ver en GitHub'}</a>
              </div>`;
          }
          // Comportamiento normal para los demás proyectos
          return `
            <div class="project-card-nether" data-project='${JSON.stringify(project)}'>
              <h3>${getText(project.title)}</h3>
              <p>${getText(project.description)}</p>
              <button class="btn-details">${currentLanguage === 'en' ? 'Details' : 'Detalles'}</button>
            </div>`;
        }).join('');


        document.querySelectorAll('.project-card-nether .btn-details').forEach(button => {
          if (button.tagName === 'BUTTON') { // Solo añadir listener a los botones, no a los enlaces <a>
            button.addEventListener('click', (e) => {
              const card = e.target.closest('.project-card-nether');
              const projectData = JSON.parse(card.dataset.project);
              showProjectDetails(projectData);
            });
          }
        });
      }

      function showProjectDetails(project) {
        const modal = document.getElementById('project-detail-modal');
        const gallery = document.getElementById('modal-gallery');
        const techStack = document.getElementById('modal-tech');

        document.getElementById('modal-title').textContent = getText(project.title);
        document.getElementById('modal-description').textContent = getText(project.longDescription || project.description);
        document.getElementById('modal-link').href = project.link;


        gallery.innerHTML = '';
        if (project.images && project.images.length > 0) {

          currentProjectImages = project.images;

          project.images.forEach((imgSrc, index) => {
            const img = document.createElement('img');
            img.src = imgSrc;
            img.alt = `Image for ${getText(project.title)}`;

            img.onerror = function () {
              console.error(`Error: No se pudo cargar la imagen en la ruta: "${imgSrc}". Verifica que el archivo exista y el nombre sea correcto.`);
              this.alt = `Error al cargar: ${imgSrc}`;
            };

            img.addEventListener('click', (e) => {
              e.stopPropagation();
              currentImageIndex = index;
              lightboxImage.src = imgSrc;
              imageLightbox.classList.remove('hidden');
            });
            gallery.appendChild(img);
          });
        } else {
          gallery.innerHTML = `<p style="color: #333; text-align: center;">No images found for this project.</p>`;
        }


        techStack.innerHTML = '';
        if (project.technologies && project.technologies.length > 0) {
          const techLabel = currentLanguage === 'en' ? 'Tech' : 'Tecnologías';
          techStack.innerHTML = `<strong>${techLabel}:</strong> ${project.technologies.join(', ')}`;
        }
        modal.classList.remove('hidden');
      }


      (function () {
        const audioPath = 'assets/textures/Voicy_Minecraft Click.mp3';
        let audioBuffer = null;
        let audioCtx = null;


        async function initAudio() {
          try {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const resp = await fetch(encodeURI(audioPath));
            const arrayBuffer = await resp.arrayBuffer();
            audioBuffer = await audioCtx.decodeAudioData(arrayBuffer.slice(0));
          } catch (e) {
            console.warn('WebAudio init failed, falling back to HTMLAudio:', e);
            audioBuffer = null;
            audioCtx = null;
          }
        }

        function playBufferedClick() {
          if (audioCtx && audioBuffer) {

            if (audioCtx.state === 'suspended') {
              audioCtx.resume();
            }
            try {
              const src = audioCtx.createBufferSource();
              src.buffer = audioBuffer;
              const gain = audioCtx.createGain();
              gain.gain.value = 0.9;
              src.connect(gain).connect(audioCtx.destination);

              src.start(0, 0.005);
            } catch (e) {

            }
          } else {

            const el = document.getElementById('ui-sound');
            if (el) {
              try {
                el.currentTime = 0;
                el.play().catch(() => { });
              } catch (e) { }
            }
          }
        }


        initAudio();
        const els = document.querySelectorAll('.mc-menu-btn, .btn, .open-chest-btn, #close-project-modal, #close-chest, #book-close-btn, #villager-trade-close-btn, #end-cv-close-btn, .book-cover, #nether-close-btn, #btn-back-to-overworld, .btn-details, #btn-language, .trade-offer');
        els.forEach(el => {
          if (!el.hasAttribute('data-no-sound')) {
            el.addEventListener('click', playBufferedClick);
          }
        });
      })();
    });
  </script>
</body>

</html>

</html> });
})();
});
</script>
</body>

</html>

</html>

</html>

</html>